<!DOCTYPE html><html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æˆèªä¿„ç¾…æ–¯æ–¹å¡ŠéŠæˆ²</title>
  <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
  <style>
    *{box-sizing:border-box}
    body{margin:0;font-family:"Noto Sans TC",sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;background:#f0f4f8;height:100vh;overflow:hidden;-webkit-user-select:none;user-select:none}
    #scoreBoard{margin-top:.5rem;font-size:1.2rem;font-weight:700}
    #gameBoard{position:relative;width:100%;max-width:480px;height:70vh;background:#fff;border:3px solid #444;border-radius:8px;overflow:hidden}
    .block{position:absolute;width:56px;height:56px;background:#8bc34a;border:2px solid #558b2f;border-radius:4px;color:#fff;font-size:1.5rem;font-weight:700;display:flex;align-items:center;justify-content:center;touch-action:none}
    .stacked{background:#4caf50}
    #slotContainer{position:absolute;bottom:8px;left:50%;transform:translateX(-50%);display:flex;gap:6px}
    .slot{width:56px;height:56px;background:#e0e0e0;border:2px dashed #9e9e9e;border-radius:4px;display:flex;align-items:center;justify-content:center}
    .slot.correct{border-color:#4caf50}
    .slot.incorrect{border-color:#f44336}
    #messageOverlay{position:absolute;inset:0;background:rgba(0,0,0,.75);color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:1.8rem;font-weight:700;text-align:center;padding:1rem;visibility:hidden;z-index:10}
    #messageOverlay button{margin:.8rem .4rem 0;padding:.6rem 1.4rem;border:none;border-radius:4px;background:#ffeb3b;font-size:1rem;font-weight:700;cursor:pointer}
  </style>
</head>
<body>
  <div id="scoreBoard">åˆ†æ•¸ï¼š0 / 20</div>
  <div id="gameBoard">
    <div id="slotContainer">
      <div class="slot" data-index="0"></div>
      <div class="slot" data-index="1"></div>
      <div class="slot" data-index="2"></div>
      <div class="slot" data-index="3"></div>
    </div>
    <div id="messageOverlay"></div>
  </div><script>
// -------------------- è³‡æ–™ --------------------
const idioms=["ä¸€ç«…ä¸é€š","ä¸æ¥ä¸‹å•","èŒ…å¡é “é–‹","ç™¼äººæ·±çœ","ä»Šéæ˜”æ¯”","è€ç”Ÿå¸¸è«‡","æ‹‹ç£šå¼•ç‰","æ‹¾äººç‰™æ…§","èªç„¡å€«æ¬¡","å¼·è©å¥ªç†","ä¸€ç‰‡å†°å¿ƒ","å¤§ç¾©å‡œç„¶","å‡ºçˆ¾åçˆ¾","å®ˆæ­£ä¸é˜¿","å¤é“ç†±è…¸","åæ‡·ä¸äº‚","é“ä¸æ‹¾éº","è¦‹ç¾©å‹‡ç‚º","æ¶“æ»´æ­¸å…¬","é£²æ°´æ€æº"];
const distractorPool="å¤©åœ°ç„é»ƒå®‡å®™æ´ªè’æ—¥æœˆç›ˆæ˜ƒè¾°å®¿åˆ—å¼µå¯’ä¾†æš‘å¾€ç§‹æ”¶å†¬è—é–é¤˜æˆæ­²å¾‹å‘‚èª¿é™½é›²é¨°è‡´é›¨éœ²çµç‚ºéœœé¢¨é›¨é›·é›»å±±å·è‰æœ¨é³¥ç¸èŸ²é­šæ±Ÿæ²³æ¹–æµ·æ˜Ÿè¾°å…‰é™°æ­²æœˆèŠ±è‰æ¨¹æœ¨".split("");

// -------------------- DOM --------------------
const board=document.getElementById('gameBoard');
const slots=[...document.querySelectorAll('.slot')];
const overlay=document.getElementById('messageOverlay');
const scoreBoard=document.getElementById('scoreBoard');

// -------------------- ç‹€æ…‹ --------------------
let score=0;
let usedIdioms=new Set();
let fallIntervals=[];
let spawnInterval;

// -------------------- å·¥å…· --------------------
const rand=(min,max)=>Math.floor(Math.random()*(max-min+1))+min;
const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=rand(0,i);[a[i],a[j]]=[a[j],a[i]];}return a;};
const updateScore=()=>scoreBoard.textContent=`åˆ†æ•¸ï¼š${score} / 20`;

// -------------------- éŠæˆ²å…¥å£ --------------------
function startGame(){
  spawnBlocks();
  spawnInterval=setInterval(spawnBlocks,10000); // æ¯ 10 ç§’
}

// -------------------- ç”Ÿæˆå­—å¡Š --------------------
function spawnBlocks(){
  if(overlay.style.visibility==='visible')return;
  if(usedIdioms.size===idioms.length)usedIdioms.clear();
  let idiom;do{idiom=idioms[rand(0,idioms.length-1)];}while(usedIdioms.has(idiom));
  usedIdioms.add(idiom);

  const chars=idiom.split("");
  const distractors=[];
  while(distractors.length<2){const c=distractorPool[rand(0,distractorPool.length-1)];if(!chars.includes(c)&&!distractors.includes(c))distractors.push(c);}
  const all=shuffle([...chars,...distractors]);
  all.forEach((char,idx)=>setTimeout(()=>createBlock(char),idx*300)); // åˆ†é–‹æ‰è½
}

function createBlock(char){
  const block=document.createElement('div');
  block.className='block';
  block.textContent=char;
  block.dataset.char=char;
  block.style.left=`${rand(0,board.clientWidth-56)}px`;
  block.style.top='-60px';
  board.appendChild(block);
  makeDraggable(block);
  startFalling(block);
}

// -------------------- ä¸‹è½èˆ‡ç¢°æ’ --------------------
function startFalling(block){
  const id=setInterval(()=>{
    if(block.isDragging)return;
    const next=block.offsetTop+2;
    if(next+56>=board.clientHeight-70||[...board.querySelectorAll('.block.stacked')].some(b=>collide(block,b,2))){
      settle(block,id);
    }else block.style.top=`${next}px`;
  },16);
  block.fallID=id;
  fallIntervals.push(id);
}
function settle(block,id){clearInterval(id);fallIntervals=fallIntervals.filter(x=>x!==id);block.classList.add('stacked');block.fallID=null;checkGameOver();}
function collide(a,b,offset=0){if(a===b)return false;const r1=a.getBoundingClientRect(),r2=b.getBoundingClientRect();return r1.left<r2.right&&r1.right>r2.left&&r1.bottom+offset>r2.top&&r1.top<r2.bottom;}

// -------------------- æ‹–æ”¾ --------------------
function makeDraggable(el){
  interact(el).draggable({
    listeners:{
      start(){
        el.isDragging=true;
        // è‹¥èµ·å§‹æ–¼ slot å…§ï¼Œç§»å› board ä¸¦é‡æ–°å®šä½
        if(el.parentElement.classList.contains('slot')){
          const slot=el.parentElement;
          slot.dataset.char='';
          slot.classList.remove('correct','incorrect');
          board.appendChild(el);
          const boardRect=board.getBoundingClientRect();
          const slotRect=slot.getBoundingClientRect();
          el.style.left=`${slotRect.left-boardRect.left}px`;
          el.style.top=`${slotRect.top-boardRect.top}px`;
          el.style.position='absolute';
          el.setAttribute('data-x',0);
          el.setAttribute('data-y',0);
          // é‡æ–°å•Ÿå‹•ä¸‹è½
          if(el.fallID==null)startFalling(el);
        }
      },
      move(evt){const x=(+el.getAttribute('data-x')||0)+evt.dx;const y=(+el.getAttribute('data-y')||0)+evt.dy;el.style.transform=`translate(${x}px,${y}px)`;el.setAttribute('data-x',x);el.setAttribute('data-y',y);},
      end(){el.isDragging=false;}
    },inertia:true
  });
}

interact('.slot').dropzone({
  accept:'.block',overlap:0.4,
  ondropactivate(e){e.target.classList.remove('correct','incorrect');},
  ondrop(e){
    const slot=e.target,block=e.relatedTarget;
    if(slot.firstElementChild)return;
    // åœæ­¢ä¸‹è½ & å›ºå®šä½ç½®
    if(block.fallID!=null){clearInterval(block.fallID);fallIntervals=fallIntervals.filter(x=>x!==block.fallID);block.fallID=null;}
    block.style.transform='none';
    block.setAttribute('data-x',0);
    block.setAttribute('data-y',0);
    block.style.position='static';
    slot.appendChild(block);
    slot.dataset.char=block.dataset.char;
    checkSlots();
  }
});

// -------------------- æˆèªåˆ¤æ–· --------------------
function checkSlots(){
  const str=slots.map(s=>s.dataset.char||'').join('');
  if(str.length!==4)return;
  if(idioms.includes(str)){
    slots.forEach(s=>s.classList.add('correct'));
    setTimeout(()=>{
      slots.forEach(s=>{if(s.firstElementChild)s.firstElementChild.remove();s.dataset.char='';s.classList.remove('correct');});
      score++;updateScore();
      if(score>=20)return endGame('ğŸ† æ­å–œä½ å–å¾—æ»¿åˆ†ï¼');
    },600);
  }else slots.forEach(s=>s.classList.add('incorrect'));
}

// -------------------- çµæŸèˆ‡é‡è¨­ --------------------
function checkGameOver(){
  if([...board.querySelectorAll('.block.stacked')].some(b=>b.offsetTop<=0)){
    endGame('game overğŸ˜­');
  }
}
function clearAll(){fallIntervals.forEach(id=>clearInterval(id));fallIntervals=[];clearInterval(spawnInterval);}
function endGame(msg){clearAll();overlay.innerHTML=`${msg}<br/>`;const r=document.createElement('button');r.textContent='é‡æ–°é–‹å§‹';r.onclick=()=>location.reload();const e=document.createElement('button');e.textContent='çµæŸéŠæˆ²';e.onclick=()=>window.close();overlay.appendChild(r);overlay.appendChild(e);overlay.style.visibility='visible';}

updateScore();
startGame();
</script></body>
</html>
