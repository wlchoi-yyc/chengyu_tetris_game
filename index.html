<!DOCTYPE html><html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æˆèªä¿„ç¾…æ–¯æ–¹å¡ŠéŠæˆ²</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin: 20px; }
    #score { font-size: 20px; margin-bottom: 10px; }
    #game { display: inline-block; }
    #grid { display: flex; }
    .column {
      width: 60px;
      height: 400px;
      background: #f0f0f0;
      border: 1px solid #999;
      margin: 0 2px;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
    }
    .block {
      width: 58px;
      height: 38px;
      background: #ffeb3b;
      margin: 1px auto;
      line-height: 38px;
      text-align: center;
      font-size: 20px;
      cursor: grab;
    }
    #spawn { margin-top: 20px; height: 60px; }
    #message { margin-top: 20px; font-size: 24px; }
    #controls button { margin: 0 10px; font-size: 16px; }
    .trophy { font-size: 48px; vertical-align: middle; }
  </style>
</head>
<body>
  <h1>æˆèªä¿„ç¾…æ–¯æ–¹å¡ŠéŠæˆ²</h1>
  <div id="score">Score: 0</div>
  <div id="game">
    <div id="grid">
      <div class="column" data-col="0"></div>
      <div class="column" data-col="1"></div>
      <div class="column" data-col="2"></div>
      <div class="column" data-col="3"></div>
    </div>
  </div>
  <div id="spawn"></div>
  <div id="message"></div>
  <div id="controls"></div>  <script>
    // æˆèªåˆ—è¡¨
    const idioms = [
      'å¡ç¿å¤±é¦¬','æ©è€³ç›œéˆ´','ç•«è›‡æ·»è¶³','åˆ»èˆŸæ±‚åŠ','å°ç‰›å½ˆç´',
      'äº•åº•ä¹‹è›™','äº¡ç¾Šè£œç‰¢','è‡ªç›¸çŸ›ç›¾','éŒ¦ä¸Šæ·»èŠ±','ç•«é¾é»ç›',
      'æ»„æµ·ä¸€ç²Ÿ','æ¯å¼“è›‡å½±','åäº•è§€å¤©','æŒ‡é¹¿ç‚ºé¦¬','å…¥æœ¨ä¸‰åˆ†',
      'ç›²äººæ‘¸è±¡','åˆ»éª¨éŠ˜å¿ƒ','èƒŒæ°´ä¸€æˆ°','ä¸€ç®­é›™éµ°','é¢¨è²é¶´å”³'
    ];
    const maxRows = 10;
    const maxScore = 20;

    let score = 0;
    let currentWord = '';
    let shuffled = [];
    let charIndex = 0;
    let currentBlock = null;

    const spawn = document.getElementById('spawn');
    const scoreEl = document.getElementById('score');
    const messageEl = document.getElementById('message');
    const controlsEl = document.getElementById('controls');
    const columns = Array.from(document.querySelectorAll('.column'));

    function updateScore() {
      scoreEl.textContent = `Score: ${score}`;
    }

    function win() {
      messageEl.innerHTML = 'æ­å–œä½ å–å¾—æ»¿åˆ† <span class="trophy">ğŸ†</span>';
      showRestart();
    }

    function gameOver() {
      messageEl.textContent = 'éŠæˆ²çµæŸï¼';
      showRestart();
    }

    function showRestart() {
      spawn.innerHTML = '';
      controlsEl.innerHTML = '';
      ['é‡æ–°é–‹å§‹','çµæŸéŠæˆ²'].forEach(text => {
        const btn = document.createElement('button');
        btn.textContent = text;
        btn.addEventListener('click', () => {
          if (text === 'é‡æ–°é–‹å§‹') restart();
          else window.location.reload();
        });
        controlsEl.appendChild(btn);
      });
    }

    function restart() {
      score = 0;
      updateScore();
      messageEl.textContent = '';
      controlsEl.innerHTML = '';
      columns.forEach(col => col.innerHTML = '');
      charIndex = 0;
      currentBlock = null;
      spawnNext();
    }

    // ç”Ÿæˆä¸‹ä¸€å€‹æ–‡å­—æ–¹å¡Š
    function spawnNext() {
      if (charIndex === 0) {
        currentWord = idioms[Math.floor(Math.random() * idioms.length)];
        shuffled = currentWord.split('').sort(() => Math.random() - 0.5);
      }
      if (charIndex >= shuffled.length) {
        charIndex = 0;
        spawnNext();
        return;
      }
      const char = shuffled[charIndex++];
      const block = document.createElement('div');
      block.className = 'block';
      block.textContent = char;
      block.draggable = true;
      block.id = 'block-' + Date.now() + '-' + charIndex;
      // æ‹–å‹•
      block.addEventListener('dragstart', e => {
        e.dataTransfer.setData('text/plain', block.id);
      });
      currentBlock = block;
      spawn.innerHTML = '';
      spawn.appendChild(block);
    }

    // å°‡æ–¹å¡Šæ”¾å…¥æŒ‡å®šæ¬„ä½çš„é€šç”¨å‡½å¼
    function dropBlockToColumn(colIndex) {
      if (!currentBlock) return;
      const col = columns[colIndex];
      col.appendChild(currentBlock);
      currentBlock.draggable = false;
      currentBlock = null;
      checkRows();
      if (score < maxScore && !messageEl.textContent) spawnNext();
    }

    // ç›£è½æ‹–æ”¾èˆ‡é»æ“Šäº‹ä»¶
    columns.forEach((col, index) => {
      col.addEventListener('dragover', e => e.preventDefault());
      col.addEventListener('drop', e => {
        e.preventDefault();
        const id = e.dataTransfer.getData('text/plain');
        const block = document.getElementById(id);
        if (block) {
          col.appendChild(block);
          block.draggable = false;
          currentBlock = null;
          checkRows();
          if (score < maxScore && !messageEl.textContent) spawnNext();
        }
      });
      // æ”¯æ´è¡Œå‹•è£ç½®é»æ“Šæ”¾ç½®
      col.addEventListener('click', () => dropBlockToColumn(index));
    });

    // æª¢æŸ¥æ˜¯å¦æ¹Šæˆå®Œæ•´æˆèªæˆ–å †ç–Šè¶…éé ‚éƒ¨
    function checkRows() {
      for (let i = 1; i <= maxRows; i++) {
        if (columns.every(col => col.children.length >= i)) {
          const chars = columns.map(col => col.children[col.children.length - i].textContent);
          const guess = chars.join('');
          if (idioms.includes(guess)) {
            columns.forEach(col => {
              const toRemove = col.children[col.children.length - i];
              col.removeChild(toRemove);
            });
            score++;
            updateScore();
            if (score >= maxScore) win();
            return;
          }
        }
      }
      if (columns.some(col => col.children.length > maxRows)) gameOver();
    }

    // å•Ÿå‹•éŠæˆ²
    updateScore();
    spawnNext();
  </script></body>
</html>
